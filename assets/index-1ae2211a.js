import{r as s,h as T,j as o}from"./index-02b61a1a.js";import{B as r}from"./index-2341704d.js";import{D as O}from"./index-b5a45999.js";import{I as W}from"./index-b0217399.js";import{B as x}from"./button-78fe6a1c.js";import{m as a}from"./index-63c81c56.js";import{C as S}from"./index-7d0886ff.js";import{T as j,a as N}from"./index-3e6fe596.js";import"./useMergedState-5e374978.js";import"./index-b03ee216.js";import"./index-ebbec8ae.js";import"./motion-a25d12c1.js";import"./index-b95a56d7.js";import"./slide-b195a0bf.js";import"./responsiveObserver-4ffafcab.js";import"./RightOutlined-91c2be32.js";import"./index-25427908.js";import"./colors-f59df799.js";import"./index-5e690ce2.js";import"./EllipsisOutlined-d703fb41.js";import"./getDataOrAriaProps-cf91de79.js";import"./index-d655db55.js";import"./collapse-97de76d4.js";import"./useFlexGapSupport-90c1898e.js";function q(){const[d,A]=s.useState(1),{ownerContractAddress:f}=r(e=>({ownerContractAddress:e.ownerContractAddress})),{ownerContractABI:g}=r(e=>({ownerContractABI:e.ownerContractABI})),{Provider:n}=r(e=>({Provider:e.Provider})),{userAddress:I}=r(e=>({userAddress:e.userAddress}));r(e=>({setUserBalance:e.setUserBalance}));const{userBalance:b}=r(e=>({userBalance:e.userBalance})),[v,l]=s.useState(!1),[C,m]=s.useState(!1),{oldOwnerContractAddress:c}=r(e=>({oldOwnerContractAddress:e.oldOwnerContractAddress})),D=async()=>{try{m(!0);const e=[{inputs:[],name:"upgrade",outputs:[],stateMutability:"nonpayable",type:"function"}],y=await new S(c,e,n),u={from:I,to:c,data:y.interface.encodeFunctionData("upgrade",[])};window.ethereum.request({method:"eth_sendTransaction",params:[u]}).then(i=>{n.waitForTransaction(i).then(async h=>{h.status===1?(a.success({content:"升级成功",duration:1}),m(!1)):(a.error({content:"升级失败",duration:1}),m(!1))}).catch(h=>{a.error({content:h.message,duration:1}),m(!1)})}).catch(i=>{a.error({content:i.message,duration:1}),m(!1)})}catch(e){a.error({content:e.message,duration:1}),m(!1)}},L=async()=>{try{l(!0),console.log(b);const e=new S(f,g,n),y={from:I,to:f,data:e.interface.encodeFunctionData("newContract",["0x0000000000000000000000000000000000000000",d])};window.ethereum.request({method:"eth_sendTransaction",params:[y]}).then(u=>{n.waitForTransaction(u).then(async i=>{if(i.status===1){a.success("创建成功");const h=await e.getCreateLength({from:I});l(!1)}else a.error("创建失败"),l(!1)}).catch(i=>{a.error(i.message),l(!1)})}).catch(u=>{a.error(u.message),l(!1)})}catch(e){a.error(e.message),l(!1)}finally{A(1)}};return T("div",{children:[o(O,{orientation:"center",children:"创建钱包"}),T(W.Group,{compact:!0,children:[o(W,{style:{width:"30%",marginLeft:"5%"},placeholder:"请输入创建钱包数量",value:d,onChange:e=>{A(e.target.value)}}),o(x,{type:"primary",style:{width:"30%"},onClick:L,loading:v,children:"创建钱包"}),o(x,{type:"default",style:{width:"30%",marginRight:"5%"},onClick:D,loading:C,children:"升级合约"})]})]})}const _=[{title:"序号",dataIndex:"id",align:"center"},{title:"地址",dataIndex:"address",align:"center",render:d=>o("div",{style:{wordWrap:"break-word",wordBreak:"break-word"},children:d})},{title:"余额",dataIndex:"balance",align:"center"}],G=()=>{const{ownerContractAddress:d}=r(t=>({ownerContractAddress:t.ownerContractAddress})),{ownerContractABI:A}=r(t=>({ownerContractABI:t.ownerContractABI})),{Provider:f}=r(t=>({Provider:t.Provider})),{userAddress:g}=r(t=>({userAddress:t.userAddress})),{BEP20TokenInfo:n}=r(t=>({BEP20TokenInfo:t.BEP20TokenInfo})),{BEP20ABI:I}=r(t=>({BEP20ABI:t.BEP20ABI})),[b,v]=s.useState([]),[l,C]=s.useState(!1),[m,c]=s.useState(!1),[D,L]=s.useState(!0),[e,y]=s.useState(!0),[u,i]=s.useState([]),h=async()=>{try{v([]),C(!0);const t=await new S(d,A,f),w=await t.getCreateLength({from:g}),p=n.address,k=await new S(p,I,f),E=n.decimals;for(let B=0;B<Number(w);B++){console.log(B);const P=await t.getCreate(g,B);console.log(P);const F=await k.balanceOf(P);console.log(P,N(F,E)),v(U=>[...U,{id:B+1,key:B,address:P,balance:N(F,E)}])}C(!1),a.success({content:"扫描成功",duration:1}),C(!1)}catch(t){a.error({content:t.message,duration:1}),C(!1)}},R=async()=>{const t=await new S(d,A,f);let w=[];u.length===b.length?w=[[n.address],g,!0,0,0]:w=[[n.address],g,!1,0,u[0]];try{c(!0),window.ethereum.request({method:"eth_sendTransaction",params:[{from:g,to:d,data:t.interface.encodeFunctionData("tranCreateToken",w)}]}).then(p=>{f.waitForTransaction(p).then(k=>{k.status===1?(a.success({content:"归集成功",duration:1}),c(!1)):(a.error({content:"归集失败",duration:1}),c(!1))}).catch(k=>{a.error({content:k.message,duration:1}),c(!1)})}).catch(p=>{a.error({content:p.message,duration:1}),c(!1)})}catch(p){a.error({content:p.message,duration:1}),c(!1)}};return s.useEffect(()=>{console.log(n.address),n.address!==void 0&&(L(!1),h())},[n]),T("div",{children:[o(O,{orientation:"center",children:"获取钱包及代币余额"}),o(x,{type:"primary",style:{width:"40%",marginLeft:"5%",marginRight:"5%",marginBottom:"3%"},onClick:h,loading:l,disabled:D,children:"扫描钱包"}),o(x,{type:"primary",style:{width:"40%",marginLeft:"5%",marginRight:"5%",marginBottom:"3%"},onClick:R,loading:m,disabled:e,children:"归集选中"}),o(j,{rowSelection:{type:"checkbox",...{onChange:(t,w)=>{console.log(`selectedRowKeys: ${t}`,"selectedRows: ",w),i(t),t.length===b.length||t.length===1?y(!1):y(!0)},getCheckboxProps:t=>({disabled:t.name==="Disabled User",name:t.name})}},pagination:!1,columns:_,dataSource:b})]})};function ge(){return T("div",{children:[o(q,{}),o(G,{})]})}export{ge as default};
