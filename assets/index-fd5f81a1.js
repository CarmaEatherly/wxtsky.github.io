import{r as o,h as T,j as s}from"./index-97b4f576.js";import{B as n}from"./index-d8a95316.js";import{D as O}from"./index-63e2e216.js";import{I as W}from"./index-37b2add3.js";import{B as x}from"./button-363d567d.js";import{m as a}from"./index-090400ec.js";import{a as S}from"./index-e0045e8b.js";import{T as j,a as N}from"./index-257270a0.js";import"./useMergedState-8fc71bbf.js";import"./index-eba01287.js";import"./responsiveObserver-1a31f032.js";import"./RightOutlined-0f888bf5.js";import"./index-c83c5398.js";import"./index-c15fed4f.js";import"./useFlexGapSupport-26a8d4c6.js";import"./getDataOrAriaProps-cf91de79.js";function q(){const[d,A]=o.useState(1),{ownerContractAddress:f}=n(e=>({ownerContractAddress:e.ownerContractAddress})),{ownerContractABI:g}=n(e=>({ownerContractABI:e.ownerContractABI})),{Provider:r}=n(e=>({Provider:e.Provider})),{userAddress:I}=n(e=>({userAddress:e.userAddress}));n(e=>({setUserBalance:e.setUserBalance}));const{userBalance:b}=n(e=>({userBalance:e.userBalance})),[v,l]=o.useState(!1),[C,u]=o.useState(!1),{oldOwnerContractAddress:c}=n(e=>({oldOwnerContractAddress:e.oldOwnerContractAddress})),D=async()=>{try{u(!0);const e=[{inputs:[],name:"upgrade",outputs:[],stateMutability:"nonpayable",type:"function"}],y=await new S(c,e,r),m={from:I,to:c,data:y.interface.encodeFunctionData("upgrade",[])};window.ethereum.request({method:"eth_sendTransaction",params:[m]}).then(i=>{r.waitForTransaction(i).then(async h=>{h.status===1?(a.success({content:"升级成功",duration:1}),u(!1)):(a.error({content:"升级失败",duration:1}),u(!1))}).catch(h=>{a.error({content:h.message,duration:1}),u(!1)})}).catch(i=>{a.error({content:i.message,duration:1}),u(!1)})}catch(e){a.error({content:e.message,duration:1}),u(!1)}},L=async()=>{try{l(!0),console.log(b);const e=new S(f,g,r),y={from:I,to:f,data:e.interface.encodeFunctionData("newContract",["0x0000000000000000000000000000000000000000",d])};window.ethereum.request({method:"eth_sendTransaction",params:[y]}).then(m=>{r.waitForTransaction(m).then(async i=>{if(i.status===1){a.success("创建成功");const h=await e.getCreateLength({from:I});l(!1)}else a.error("创建失败"),l(!1)}).catch(i=>{a.error(i.message),l(!1)})}).catch(m=>{a.error(m.message),l(!1)})}catch(e){a.error(e.message),l(!1)}finally{A(1)}};return T("div",{children:[s(O,{orientation:"center",children:"创建钱包"}),T(W.Group,{compact:!0,children:[s(W,{style:{width:"30%",marginLeft:"5%"},placeholder:"请输入创建钱包数量",value:d,onChange:e=>{A(e.target.value)}}),s(x,{type:"primary",style:{width:"30%"},onClick:L,loading:v,children:"创建钱包"}),s(x,{type:"default",style:{width:"30%",marginRight:"5%"},onClick:D,loading:C,children:"升级合约"})]})]})}const _=[{title:"序号",dataIndex:"id",align:"center"},{title:"地址",dataIndex:"address",align:"center",render:d=>s("div",{style:{wordWrap:"break-word",wordBreak:"break-word"},children:d})},{title:"余额",dataIndex:"balance",align:"center"}],G=()=>{const{ownerContractAddress:d}=n(t=>({ownerContractAddress:t.ownerContractAddress})),{ownerContractABI:A}=n(t=>({ownerContractABI:t.ownerContractABI})),{Provider:f}=n(t=>({Provider:t.Provider})),{userAddress:g}=n(t=>({userAddress:t.userAddress})),{BEP20TokenInfo:r}=n(t=>({BEP20TokenInfo:t.BEP20TokenInfo})),{BEP20ABI:I}=n(t=>({BEP20ABI:t.BEP20ABI})),[b,v]=o.useState([]),[l,C]=o.useState(!1),[u,c]=o.useState(!1),[D,L]=o.useState(!0),[e,y]=o.useState(!0),[m,i]=o.useState([]),h=async()=>{try{v([]),C(!0);const t=await new S(d,A,f),w=await t.getCreateLength({from:g}),p=r.address,k=await new S(p,I,f),E=r.decimals;for(let B=0;B<Number(w);B++){console.log(B);const P=await t.getCreate(g,B);console.log(P);const F=await k.balanceOf(P);console.log(P,N(F,E)),v(U=>[...U,{id:B+1,key:B,address:P,balance:N(F,E)}])}C(!1),a.success({content:"扫描成功",duration:1}),C(!1)}catch(t){a.error({content:t.message,duration:1}),C(!1)}},R=async()=>{const t=await new S(d,A,f);let w=[];m.length===b.length?w=[[r.address],g,!0,0,0]:w=[[r.address],g,!1,0,m[0]];try{c(!0),window.ethereum.request({method:"eth_sendTransaction",params:[{from:g,to:d,data:t.interface.encodeFunctionData("tranCreateToken",w)}]}).then(p=>{f.waitForTransaction(p).then(k=>{k.status===1?(a.success({content:"归集成功",duration:1}),c(!1)):(a.error({content:"归集失败",duration:1}),c(!1))}).catch(k=>{a.error({content:k.message,duration:1}),c(!1)})}).catch(p=>{a.error({content:p.message,duration:1}),c(!1)})}catch(p){a.error({content:p.message,duration:1}),c(!1)}};return o.useEffect(()=>{console.log(r.address),r.address!==void 0&&(L(!1),h())},[r]),T("div",{children:[s(O,{orientation:"center",children:"获取钱包及代币余额"}),s(x,{type:"primary",style:{width:"40%",marginLeft:"5%",marginRight:"5%",marginBottom:"3%"},onClick:h,loading:l,disabled:D,children:"扫描钱包"}),s(x,{type:"primary",style:{width:"40%",marginLeft:"5%",marginRight:"5%",marginBottom:"3%"},onClick:R,loading:u,disabled:e,children:"归集选中"}),s(j,{rowSelection:{type:"checkbox",...{onChange:(t,w)=>{console.log(`selectedRowKeys: ${t}`,"selectedRows: ",w),i(t),t.length===b.length||t.length===1?y(!1):y(!0)},getCheckboxProps:t=>({disabled:t.name==="Disabled User",name:t.name})}},pagination:!1,columns:_,dataSource:b})]})};function oe(){return T("div",{children:[s(q,{}),s(G,{})]})}export{oe as default};
