import{r as o,h as S,j as r}from"./index-7089f0c5.js";import{B as i}from"./index-0ba586d2.js";import{D as z}from"./index-7e4c1cc4.js";import{T as H,a as q,b as G,S as J}from"./index-15e441fc.js";import{M as K,F as M}from"./index-ff49bbca.js";import{I as g}from"./index-17f21841.js";import{B as O}from"./button-765b2b89.js";import{m as s}from"./index-efd90cf0.js";import{C as N}from"./index-398a6cb1.js";import{A as Q}from"./index-a071e0c3.js";import{S as R}from"./index-f6322046.js";import"./useMergedState-fbc81726.js";import"./index-06026943.js";import"./index-a948ca11.js";import"./motion-91bd957a.js";import"./responsiveObserver-3d124228.js";import"./RightOutlined-077fefae.js";import"./index-eb4a3e1a.js";import"./colors-bbae17d5.js";import"./index-cddc561c.js";import"./getDataOrAriaProps-cf91de79.js";import"./Dropdown-29a5afe6.js";import"./slide-31926304.js";import"./EllipsisOutlined-f0630127.js";import"./index-bf4b72da.js";import"./collapse-97de76d4.js";import"./useFlexGapSupport-eda7ec6f.js";import"./row-d47acc03.js";import"./fade-9063b095.js";const X=()=>{const[C,l]=o.useState(!1),[D,m]=o.useState(!1),[u,U]=o.useState(""),[v,W]=o.useState(""),{WBNBAddress:T}=i(e=>({WBNBAddress:e.WBNBAddress})),{userAddress:n}=i(e=>({userAddress:e.userAddress})),{Provider:f}=i(e=>({Provider:e.Provider})),{BEP20ABI:d}=i(e=>({BEP20ABI:e.BEP20ABI})),{USDTAddress:w}=i(e=>({USDTAddress:e.USDTAddress})),{ownerContractAddress:c}=i(e=>({ownerContractAddress:e.ownerContractAddress})),[k,p]=o.useState(0),[P,I]=o.useState(0),[x,y]=o.useState(!1),h=async()=>{try{y(!0);const e=new N(T,d,f),a=new N(w,d,f),V=await e.allowance(n,c),_=await a.allowance(n,c),L=q(V,18),j=q(_,18);console.log("ApproveWBNBNumber",L,"ApproveUSDTNumber",j),p(Number(L).toFixed(3)),I(Number(j).toFixed(3)),s.success({content:"获取授权成功",duration:1}),y(!1)}catch{s.error({content:"获取授权失败",duration:1}),y(!1)}},E=()=>{m(!0);let e=[];try{if(v==="授权WBNB代币到合约"){const a=new N(T,d,f);e.push({from:n,to:T,data:a.interface.encodeFunctionData("approve",[c,G(u,18)])})}else if(v==="授权USDT代币到合约"){const a=new N(w,d,f);e.push({from:n,to:w,data:a.interface.encodeFunctionData("approve",[c,G(u,18)])})}window.ethereum.request({method:"eth_sendTransaction",params:e}).then(a=>{f.waitForTransaction(a).then(V=>{V.status===1?(s.success("授权成功"),m(!1),l(!1),h()):(s.error("授权失败"),m(!1),l(!1))})}).catch(a=>{s.error(a.message),m(!1),l(!1)})}catch(a){s.error(a.message),m(!1),l(!1)}},B=()=>{l(!1)},b={width:"80%",marginTop:"1%",marginLeft:"10%",marginRight:"10%"},F=e=>{W("授权"+e.name+"代币到合约"),l(!0),console.log(e)},t=[{title:"代币",dataIndex:"name",key:"name",align:"center"},{title:"已授权数量",dataIndex:"amount",key:"amount",align:"center"},{title:"授权",key:"action",align:"center",render:e=>r(J,{children:r(O,{type:"primary",onClick:()=>F(e),children:"授权"})})}],A=[{key:"1",name:"WBNB",amount:k,action:"WBNB"},{key:"2",name:"USDT",amount:P,action:"USDT"}];return o.useEffect(()=>{n!==""&&h().then(e=>console.log("getApprove"))},[]),S("div",{children:[r(z,{orientation:"center",children:"授权信息"}),r(H,{style:b,columns:t,pagination:!1,dataSource:A}),r(K,{title:v,open:C,onOk:E,confirmLoading:D,onCancel:B,children:r(M,{children:r(M.Item,{label:"输入授权数量",children:r(g,{value:u,onChange:e=>U(e.target.value)})})})}),r(O,{type:"primary",onClick:()=>h(),style:b,loading:x,children:"刷新授权信息"})]})};function Y(){const{Provider:C}=i(t=>({Provider:t.Provider})),{userAddress:l}=i(t=>({userAddress:t.userAddress})),{ownerContractAddress:D}=i(t=>({ownerContractAddress:t.ownerContractAddress})),{ownerContractABI:m}=i(t=>({ownerContractABI:t.ownerContractABI})),{BEP20TokenInfo:u}=i(t=>({BEP20TokenInfo:t.BEP20TokenInfo})),{WBNBAddress:U}=i(t=>({WBNBAddress:t.WBNBAddress})),{USDTAddress:v}=i(t=>({USDTAddress:t.USDTAddress})),[W,T]=o.useState("WBNB"),[n,f]=o.useState(0),[d,w]=o.useState(0),[c,k]=o.useState(0),[p,P]=o.useState(20),[I,x]=o.useState("发送到合约创建地址"),[y,h]=o.useState(!0),[E,B]=o.useState(!1);o.useEffect(()=>{u.address!==void 0&&n>0&&d>0&&c>0&&p>0?h(!1):h(!0)},[u.address,n,d,c,p]);const b=()=>n<=0?(s.error("购买数量不合法"),!1):d<=0?(s.error("每个地址购买数量不合法"),!1):c<=0?(s.error("总地址数量不合法"),!1):p<=0?(s.error("滑点不合法"),!1):!0,F=()=>{if(!b())return;const t=new N(D,m,C);let A=[];W==="WBNB"?I==="发送到合约创建地址"?A=[p,[U,u.address],n*1e4,d*1e4,c,"0x0000000000000000000000000000000000000000"]:A=[p,[U,u.address],n*1e4,d*1e4,c,l]:W==="USDT"&&(I==="发送到合约创建地址"?A=[p,[v,u.address],n*1e4,d*1e4,c,"0x0000000000000000000000000000000000000000"]:A=[p,[v,u.address],n*1e4,d*1e4,c,l]);try{B(!0),window.ethereum.request({method:"eth_sendTransaction",params:[{from:l,to:D,data:t.interface.encodeFunctionData("buy",A)}]}).then(e=>{C.waitForTransaction(e).then(a=>{a.status===1?(s.success({content:"购买成功",duration:1}),B(!1)):(s.error({content:"购买失败",duration:1}),B(!1))})}).catch(e=>{s.error({content:e.message,duration:1}),B(!1)})}catch(e){s.error({content:e.message,duration:1}),B(!1)}};return S("div",{style:{width:"80%",marginTop:"1%",marginLeft:"10%",marginRight:"10%"},children:[r(Q,{message:"什么池子用什么币购买,买之前确定好池子",type:"warning",style:{textAlign:"center"}}),S(g.Group,{compact:!0,style:{marginTop:"1%"},children:[S(R,{defaultValue:"WBNB",style:{width:"30%"},onChange:t=>T(t),children:[r(Option,{value:"WBNB",children:"WBNB"}),r(Option,{value:"USDT",children:"USDT"})]}),r(g,{style:{width:"70%"},onChange:t=>f(t.target.value),placeholder:"选择购买方式, 输入购买数量"})]}),r(g,{addonBefore:"单地址购买Token数量",style:{width:"100%",marginTop:"3%"},onChange:t=>w(t.target.value),placeholder:"输入购买数量"}),r(g,{addonBefore:"总共购买地址数量",style:{width:"100%",marginTop:"3%"},placeholder:"输入购买数量",onChange:t=>k(t.target.value)}),S(g.Group,{compact:!0,style:{marginTop:"3%"},children:[r(g,{addonBefore:"滑点",style:{width:"40%"},onChange:t=>P(t.target.value),placeholder:"0-99"}),S(R,{defaultValue:"发送到合约创建地址",style:{width:"60%"},onChange:t=>x(t),children:[r(Option,{value:"发送到合约创建地址",children:"发送到合约创建地址"}),r(Option,{value:"全部转移到自己地址",children:"全部转移到自己地址"})]})]}),r(O,{type:"primary",style:{width:"100%",marginTop:"3%"},onClick:F,disabled:y,loading:E,children:"购买"})]})}function Ue(){return S("div",{children:[r(X,{}),r(Y,{})]})}export{Ue as default};
