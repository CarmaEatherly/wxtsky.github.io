import{r as s,h as T,j as o}from"./index-7089f0c5.js";import{B as r}from"./index-0ba586d2.js";import{D as O}from"./index-7e4c1cc4.js";import{I as E}from"./index-17f21841.js";import{B as x}from"./button-765b2b89.js";import{m as a}from"./index-efd90cf0.js";import{C as k}from"./index-398a6cb1.js";import{T as _,a as R}from"./index-15e441fc.js";import"./useMergedState-fbc81726.js";import"./index-06026943.js";import"./index-a948ca11.js";import"./motion-91bd957a.js";import"./index-f6322046.js";import"./slide-31926304.js";import"./responsiveObserver-3d124228.js";import"./RightOutlined-077fefae.js";import"./index-eb4a3e1a.js";import"./colors-bbae17d5.js";import"./index-cddc561c.js";import"./getDataOrAriaProps-cf91de79.js";import"./Dropdown-29a5afe6.js";import"./EllipsisOutlined-f0630127.js";import"./index-bf4b72da.js";import"./collapse-97de76d4.js";import"./useFlexGapSupport-eda7ec6f.js";function G(){const[d,A]=s.useState(1),{ownerContractAddress:g}=r(t=>({ownerContractAddress:t.ownerContractAddress})),{ownerContractABI:f}=r(t=>({ownerContractABI:t.ownerContractABI})),{Provider:n}=r(t=>({Provider:t.Provider})),{userAddress:I}=r(t=>({userAddress:t.userAddress}));r(t=>({setUserBalance:t.setUserBalance}));const{userBalance:b}=r(t=>({userBalance:t.userBalance})),[v,l]=s.useState(!1),[C,m]=s.useState(!1),{oldOwnerContractAddress:c}=r(t=>({oldOwnerContractAddress:t.oldOwnerContractAddress})),L=async()=>{try{m(!0);const t=[{inputs:[],name:"upgrade",outputs:[],stateMutability:"nonpayable",type:"function"}],y=await new k(c,t,n),u={from:I,to:c,data:y.interface.encodeFunctionData("upgrade",[])};window.ethereum.request({method:"eth_sendTransaction",params:[u]}).then(i=>{n.waitForTransaction(i).then(async h=>{h.status===1?(a.success({content:"升级成功",duration:1}),m(!1)):(a.error({content:"升级失败",duration:1}),m(!1))}).catch(h=>{a.error({content:h.message,duration:1}),m(!1)})}).catch(i=>{a.error({content:i.message,duration:1}),m(!1)})}catch(t){a.error({content:t.message,duration:1}),m(!1)}},D=async()=>{try{l(!0),console.log(b);const t=new k(g,f,n),y={from:I,to:g,data:t.interface.encodeFunctionData("newContract",["0x0000000000000000000000000000000000000000",d])};window.ethereum.request({method:"eth_sendTransaction",params:[y]}).then(u=>{n.waitForTransaction(u).then(async i=>{if(i.status===1){a.success("创建成功");const h=await t.getCreateLength({from:I});l(!1)}else a.error("创建失败"),l(!1)}).catch(i=>{a.error(i.message),l(!1)})}).catch(u=>{a.error(u.message),l(!1)})}catch(t){a.error(t.message),l(!1)}finally{A(1)}};return T("div",{children:[o(O,{orientation:"center",children:"创建钱包"}),T(E.Group,{compact:!0,children:[o(E,{style:{width:"30%",marginLeft:"5%"},placeholder:"请输入创建钱包数量",value:d,onChange:t=>{A(t.target.value)}}),o(x,{type:"primary",style:{width:"30%"},onClick:D,loading:v,children:"创建钱包"}),o(x,{type:"default",style:{width:"30%",marginRight:"5%"},onClick:L,loading:C,children:"升级合约"})]})]})}const M=[{title:"序号",dataIndex:"id",align:"center"},{title:"地址",dataIndex:"address",align:"center",render:d=>o("div",{style:{wordWrap:"break-word",wordBreak:"break-word"},children:d})},{title:"余额",dataIndex:"balance",align:"center"}],$=()=>{const{ownerContractAddress:d}=r(e=>({ownerContractAddress:e.ownerContractAddress})),{ownerContractABI:A}=r(e=>({ownerContractABI:e.ownerContractABI})),{Provider:g}=r(e=>({Provider:e.Provider})),{userAddress:f}=r(e=>({userAddress:e.userAddress})),{BEP20TokenInfo:n}=r(e=>({BEP20TokenInfo:e.BEP20TokenInfo})),{BEP20ABI:I}=r(e=>({BEP20ABI:e.BEP20ABI})),[b,v]=s.useState([]),[l,C]=s.useState(!1),[m,c]=s.useState(!1),[L,D]=s.useState(!0),[t,y]=s.useState(!0),[u,i]=s.useState(0),[h,U]=s.useState([]),F=async()=>{try{v([]),C(!0);const e=await new k(d,A,g),p=await e.getCreateLength({from:f}),w=n.address,S=await new k(w,I,g),W=n.decimals;for(let B=0;B<Number(p);B++){console.log(B);const P=await e.getCreate(f,B);console.log(P);const N=await S.balanceOf(P);console.log(P,R(N,W)),v(q=>[...q,{id:B+1,key:B,address:P,balance:R(N,W)}])}C(!1),a.success({content:"扫描成功",duration:1}),C(!1)}catch(e){a.error({content:e.message,duration:1}),C(!1)}},j=async()=>{const e=await new k(d,A,g);let p=[];h.length===b.length?p=[[n.address],f,!0,u,0]:p=[[n.address],f,!1,u,h[0]];try{c(!0),window.ethereum.request({method:"eth_sendTransaction",params:[{from:f,to:d,data:e.interface.encodeFunctionData("tranCreateToken",p)}]}).then(w=>{g.waitForTransaction(w).then(S=>{S.status===1?(a.success({content:"归集成功",duration:1}),c(!1)):(a.error({content:"归集失败",duration:1}),c(!1))}).catch(S=>{a.error({content:S.message,duration:1}),c(!1)})}).catch(w=>{a.error({content:w.message,duration:1}),c(!1)})}catch(w){a.error({content:w.message,duration:1}),c(!1)}};return s.useEffect(()=>{console.log(n.address),n.address!==void 0&&(D(!1),F())},[n]),T("div",{children:[o(O,{orientation:"center",children:"获取钱包及代币余额"}),o(E,{style:{width:"90%",marginLeft:"5%",marginRight:"5%",marginBottom:"1%"},placeholder:"请输入每个钱包归集数量,不填则为全部",onChange:e=>{i(e.target.value)}}),o(x,{type:"primary",style:{width:"40%",marginLeft:"5%",marginRight:"5%",marginBottom:"1%"},onClick:F,loading:l,disabled:L,children:"扫描钱包"}),o(x,{type:"primary",style:{width:"40%",marginLeft:"5%",marginRight:"5%",marginBottom:"1%"},onClick:j,loading:m,disabled:t,children:"归集选中"}),o(_,{rowSelection:{type:"checkbox",...{onChange:(e,p)=>{console.log(`selectedRowKeys: ${e}`,"selectedRows: ",p),U(e),e.length===b.length||e.length===1?y(!1):y(!0)},getCheckboxProps:e=>({disabled:e.name==="Disabled User",name:e.name})}},pagination:!1,columns:M,dataSource:b})]})};function we(){return T("div",{children:[o(G,{}),o($,{})]})}export{we as default};
